
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Usercentrics LCP Workaround Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body { margin:0; font-family:Arial, sans-serif; background:#111; color:#fff; }
  .hero {
    width:100%;
    height:60px; /* small so CMP becomes LCP */
    background:#333;
  }
  .content {
    padding:20px;
    font-size:18px;
  }
</style>

<!-- Usercentrics CMP -->
<script src="https://web.cmp.usercentrics.eu/tcf/stub.js"></script>
<script id="usercentrics-cmp"
        src="https://web.cmp.usercentrics.eu/ui/loader.js"
        data-settings-id="EB4fNiNKxOwpYl"
        async></script>

<!-- Workaround: split privacy text into paragraphs -->
<script>
(function UC_LCP_Fix() {
  const log = (...a) => console.log("[UC-LCP-FIX]", ...a);

  function findRealPrivacyNode() {
    // encontrar todos os elementos com shadowRoot
    const hosts = [...document.querySelectorAll("*")].filter(el => el.shadowRoot);
    for (const host of hosts) {
      const real = host.shadowRoot.querySelector(".privacy-text-detailed");
      if (real) {
        log("FOUND REAL PRIVACY NODE in:", host.tagName);
        return real;
      }
    }
    return null;
  }

  function splitParagraphs(node) {
    if (!node) return log("privacy-text-detailed not found");

    const original = node.innerText.trim();
    if (!original) return log("Text empty or not ready");

    // já dividido?
    if (node.innerHTML.includes("<p>")) {
      return log("Paragraphs already applied — skipping");
    }

    log("Splitting text into paragraphs...");

    // dividir por ponto final + espaço
    const parts = original.split(/\.\s+/).filter(Boolean);

    node.innerHTML = parts
      .map(sentence => `<p>${sentence.trim()}.</p>`)
      .join("");

    log("Paragraphs applied!");
  }

  function tryApply() {
    const node = findRealPrivacyNode();
    if (node) splitParagraphs(node);
  }

  // tentar várias vezes até o CMP carregar
  const interval = setInterval(() => {
    tryApply();
  }, 250);

  // parar após 10s
  setTimeout(() => clearInterval(interval), 10000);

  // observar alterações (CMP re-render)
  new MutationObserver(() => tryApply())
    .observe(document.documentElement, { childList: true, subtree: true });

  log("Workaround script loaded");
})();
</script>





</head>
<body>

<div class="hero"></div>

<div class="content">
  <h1>CMP LCP Workaround Test Page</h1>
  <p>This page forces the CMP to become the initial LCP and applies the paragraph workaround for testing.</p>
</div>

</body>
</html>
