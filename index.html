
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Usercentrics LCP Workaround Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body { margin:0; font-family:Arial, sans-serif; background:#111; color:#fff; }
  .hero {
    width:100%;
    height:60px; /* small so CMP becomes LCP */
    background:#333;
  }
  .content {
    padding:20px;
    font-size:18px;
  }
</style>

<!-- Usercentrics CMP -->
<script src="https://web.cmp.usercentrics.eu/tcf/stub.js"></script>
<script id="usercentrics-cmp"
        src="https://web.cmp.usercentrics.eu/ui/loader.js"
        data-settings-id="EB4fNiNKxOwpYl"
        async></script>

<!-- Workaround: split privacy text into paragraphs -->
<script>
(function() {
  function splitPrivacyText(shadow) {
    // tentar encontrar o span com o texto legal
    const span = shadow.querySelector('#uc-privacy-description .privacy-text-detailed');
    if (!span) {
      console.log('[UC-LCP-FIX] privacy-text-detailed not found in this shadowRoot');
      return;
    }

    // evitar processar duas vezes
    if (span.innerHTML.includes('<p')) {
      console.log('[UC-LCP-FIX] Text already split, skipping');
      return;
    }

    const original = span.textContent.trim();
    if (!original) {
      console.log('[UC-LCP-FIX] Empty privacy text, nothing to split');
      return;
    }

    console.log('[UC-LCP-FIX] Original text length:', original.length);

    // dividir por frases (. ! ?)
    const sentences = original.split(/(?<=[.!?])\s+/);
    console.log('[UC-LCP-FIX] Sentences:', sentences.length);

    span.innerHTML = sentences
      .map(s => `<p style="margin:0 0 10px 0; line-height:1.35;">${s}</p>`)
      .join('');

    console.log('[UC-LCP-FIX] Privacy text successfully split into paragraphs');
  }

  function applyOverride() {
    const host = document.querySelector('.uc-embed');
    if (!host || !host.shadowRoot) {
      console.log('[UC-LCP-FIX] .uc-embed host or shadowRoot not ready');
      return;
    }

    const shadow = host.shadowRoot;
    splitPrivacyText(shadow);

    // observar alterações internas ao shadowRoot (re-render do CMP)
    new MutationObserver(() => splitPrivacyText(shadow))
      .observe(shadow, { childList: true, subtree: true });
  }

  // correr quando o DOM estiver pronto
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', applyOverride);
  } else {
    applyOverride();
  }

  // observar o DOM principal para quando .uc-embed aparecer
  new MutationObserver(() => applyOverride())
    .observe(document.documentElement, { childList: true, subtree: true });

  console.log('[UC-LCP-FIX] Workaround script loaded (using .uc-embed)');
})();
</script>


</head>
<body>

<div class="hero"></div>

<div class="content">
  <h1>CMP LCP Workaround Test Page</h1>
  <p>This page forces the CMP to become the initial LCP and applies the paragraph workaround for testing.</p>
</div>

</body>
</html>
